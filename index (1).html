<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kano Wand Coding Kit</title>
<script src="https://unpkg.com/blockly/blockly.min.js"></script>
<style>
body { margin:0; display:flex; height:100vh; font-family:Arial, sans-serif; background:#1e1f22; color:white; }
#sidebar { width:70px; background:#2b2d31; display:flex; flex-direction:column; align-items:center; padding-top:20px; gap:16px; }
.sideIcon { width:40px; height:40px; border-radius:50%; background:#3a3c41; display:flex; justify-content:center; align-items:center; font-size:20px; cursor:pointer; }
.sideIcon:hover { background:#8ec5ff; transform:scale(1.1); }
#center { flex:1; display:flex; flex-direction:column; background:#2d2f33; }
#blocklyDiv { flex:1; }
#right { width:380px; min-width:300px; background:#1f2023; display:flex; flex-direction:column; padding:20px; gap:20px; }
#canvasBox { background:#0d0d0f; border-radius:12px; padding:4px; aspect-ratio:16/9; cursor:crosshair; position:relative; }
#canvas { width:100%; height:100%; border-radius:10px; display:block; }
.panel { background:#2b2d31; border-radius:12px; padding:10px; flex:0; display:flex; justify-content:flex-start; }
button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; margin-right:10px; }
.run { background:#8ec5ff; color:#000; }
.stop { background:#ff8e8e; color:#000; }
#settingsModal { display:none; position:absolute; top:50px; left:50%; transform:translateX(-50%); width:300px; background:#2b2d31; border-radius:12px; padding:20px; z-index:100; color:white; }
#settingsModal h3 { margin-top:0; }
#settingsModal span { position:absolute; top:10px; right:15px; cursor:pointer; }
</style>
</head>
<body>

<div id="sidebar">
  <div class="sideIcon">üë§</div>
  <div class="sideIcon">üìÑ</div>
  <div class="sideIcon" id="settingsBtn">‚öôÔ∏è</div>
</div>

<div id="center">
  <div id="blocklyDiv"></div>
</div>

<div id="right">
  <div id="canvasBox"><canvas id="canvas"></canvas></div>
  <div class="panel">
    <button class="run" onclick="runCode()">‚ñ∂</button>
    <button class="stop" onclick="stopCode()">‚ñ†</button>
  </div>
</div>

<div id="settingsModal">
  <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
  <button onclick="connectBluetooth()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –ø–∞–ª–æ—á–∫—É</button>
  <button onclick="emulateConnection()">–≠–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
  <button onclick="changeLanguage()">–Ø–∑—ã–∫</button>
  <span onclick="closeSettings()">‚úñ</span>
</div>

<xml id="toolbox" style="display:none">
  <category name="–ù–∞—á–∞–ª–æ" colour="#ffb347">
    <block type="start_program"></block>
    <block type="wand_forever"></block>
  </category>
  <category name="–î–≤–∏–∂–µ–Ω–∏–µ/–†–∏—Å–æ–≤–∞–Ω–∏–µ" colour="#8ec5ff">
    <block type="wand_move_to_xy"></block>
    <block type="wand_draw_circle">
      <value name="RADIUS"><block type="math_number"><field name="NUM">10</field></block></value>
    </block>
    <block type="wand_cast_color"></block>
    <block type="remove_fire"></block>
    <block type="create_object">
      <value name="SPRITE_URL"><block type="text"><field name="TEXT">url_–∫_—Å–ø—Ä–∞–π—Ç—É.png</field></block></value>
      <value name="X"><block type="math_number"><field name="NUM">0</field></block></value>
      <value name="Y"><block type="math_number"><field name="NUM">0</field></block></value>
    </block>
    <block type="if_luminus_mag"></block>
    <block type="luminus_effect"></block>
    <!-- –ù–û–í–Ü –ë–õ–û–ö–ò –î–õ–Ø –°–õ–Ü–î–£ -->
    <block type="set_trail_type"></block>
    <block type="set_trail_color"></block>
    <block type="set_trail_size"></block>
    <block type="clear_trail"></block>
  </category>
  <category name="–ü–∞–ª–æ—á–∫–∞" colour="#ffde59">
    <block type="wand_led_color"></block>
    <block type="wand_led_set"></block>
    <block type="wand_up"></block>
    <block type="wand_down"></block>
    <block type="wand_left"></block>
    <block type="wand_right"></block>
    <block type="wand_moved_x"></block>
    <block type="wand_moved_y"></block>
    <block type="wand_led_signal"></block>
    <!-- –ù–û–í–Ü –ë–õ–û–ö–ò –ü–ê–õ–û–ß–ö–ò -->
    <block type="wand_get_x"></block>
    <block type="wand_get_y"></block>
    <block type="use_wand_position"></block>
  </category>
  <category name="–õ–æ–≥–∏–∫–∞" colour="#ffd28e">
    <block type="controls_if"></block>
    <block type="logic_compare"></block>
    <block type="wait_seconds">
      <value name="SECONDS"><block type="math_number"><field name="NUM">1</field></block></value>
    </block>
    <block type="math_number"></block>
    <block type="text"></block>
  </category>
  <category name="–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ" custom="VARIABLE">
    <block type="set_price">
      <value name="VALUE"><block type="math_number"><field name="NUM">100</field></block></value>
    </block>
  </category>
</xml>

<script>
/* ---------- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---------- */
let isRunning = false;
let cursorX = 0;
let cursorY = 0;
let —Ü–µ–Ω–∞ = 0;
let drawInterval;
let wandConnected = false;
let history = [];

const wandState = {
  tiltX: 0,
  tiltY: 0,
  buttonPressed: false
};

let bluetoothDevice, bluetoothServer, ledCharacteristic;

/* ---------- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ª—ñ–¥—É ---------- */
const trailSettings = {
  type: 'fire', // fire, sparkles, rainbow, snow, magic
  color: null, // null = –∞–≤—Ç–æ –∫–æ–ª—ñ—Ä –¥–ª—è —Ç–∏–ø—É
  size: 1.0, // –º–Ω–æ–∂–Ω–∏–∫ —Ä–æ–∑–º—ñ—Ä—É
  enabled: true,
  particlesCount: 30,
  followSpeed: 0.15,
  trailLength: 100 // –¥–æ–≤–∂–∏–Ω–∞ —Å–ª—ñ–¥—É –≤ –∫–∞–¥—Ä–∞—Ö
};

/* ---------- Theme ---------- */
const DARK_THEME = Blockly.Theme.defineTheme('dark', {
  'base': Blockly.Themes.Classic,
  'blockStyles': {
    'start_blocks': {'colourPrimary':'#ffb347','colourSecondary':'#e6993e','colourTertiary':'#cca64d'},
    'motion_blocks': {'colourPrimary':'#8ec5ff','colourSecondary':'#6ab0f3','colourTertiary':'#aad1ff'},
    'flow_blocks': {'colourPrimary':'#ffd28e','colourSecondary':'#e6b86f','colourTertiary':'#ffd699'},
    'input_blocks': {'colourPrimary':'#8eff99','colourSecondary':'#6fdc77','colourTertiary':'#a4f3aa'},
    'variable_blocks': {'colourPrimary':'#ffde59','colourSecondary':'#e6c84d','colourTertiary':'#ffd699'}
  },
  'categoryStyles': {
    'logic_category': {'colour':'#ffd28e'},
    'loop_category': {'colour':'#ffb347'},
    'motion_category': {'colour':'#8ec5ff'},
    'sensor_category': {'colour':'#8eff99'},
    'wand_category': {'colour':'#ffde59'},
    'variable_category': {'colour':'#ffde59'}
  },
  'componentStyles': {
    'workspaceBackgroundColour': '#2d2f33',
    'toolboxBackgroundColour': '#1f2023',
    'toolboxForegroundColour': '#ffffff',
    'flyoutBackgroundColour': '#3a3c41',
    'flyoutForegroundColour': '#ffffff',
    'scrollbarColour': '#888',
    'scrollbarHoverColour': '#aaa'
  }
});

/* ---------- Blocks ---------- */
Blockly.defineBlocksWithJsonArray([
  { type:"start_program", message0:"–ù–∞—á–∞–ª–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è", nextStatement:null, style:"start_blocks" },
  { type:"wand_forever", message0:"–ü–æ–≤—Ç–æ—Ä—è—Ç—å –≤–µ—á–Ω–æ %1 %2", args0:[{type:"input_dummy"},{type:"input_statement",name:"DO"}], style:"flow_blocks" },
  { type:"wand_move_to_xy", message0:"–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫—É—Ä—Å–æ—Ä X:%1 Y:%2", args0:[
      {type:"input_value", name:"X", check:"Number"},
      {type:"input_value", name:"Y", check:"Number"}], previousStatement:null, nextStatement:null, style:"motion_blocks"
  },
  { type:"wand_draw_circle", message0:"–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫—Ä—É–≥ —Ä–∞–¥–∏—É—Å %1 —Ü–≤–µ—Ç %2", args0:[
      {type:"input_value",name:"RADIUS",check:"Number"},
      {type:"field_colour", name:"COLOR", colour:"#6A0DAD"}], previousStatement:null, nextStatement:null, style:"motion_blocks"
  },
  { type:"wand_cast_color", message0:"–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ —Å —Ü–≤–µ—Ç–æ–º %1", args0:[
      {type:"field_dropdown", name:"COLOR", options:[["–°–∏–Ω–∏–π","#8ec5ff"],["–ó–µ–ª–µ–Ω—ã–π","#8eff99"],["–ö—Ä–∞—Å–Ω—ã–π","#ff8e8e"],["Random","random"]]}],
      previousStatement:null, nextStatement:null, style:"motion_blocks"
  },
  {
      type: "remove_fire",
      message0: "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –æ–≥–Ω—è",
      previousStatement: null,
      nextStatement: null,
      style: "motion_blocks"
  },
  {
      type: "create_object",
      message0: "–°–æ–∑–¥–∞—Ç—å –û–±—ä–µ–∫—Ç –∏–∑ URL %1 –≤ X:%2 Y:%3",
      args0: [
          { type: "input_value", name: "SPRITE_URL", check: "String" },
          { type: "input_value", name: "X", check: "Number" },
          { type: "input_value", name: "Y", check: "Number" }
      ],
      previousStatement: null,
      nextStatement: null,
      style: "motion_blocks"
  },
  {
      type: "set_price",
      message0: "–°–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É %1 –Ω–∞ %2",
      args0: [
          { type: "field_variable", name: "VAR", variable: "—Ü–µ–Ω–∞" },
          { type: "input_value", name: "VALUE", check: "Number" }
      ],
      previousStatement: null,
      nextStatement: null,
      style: "variable_blocks"
  },
  { type:"wand_led_color", message0:"–ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ %1", args0:[{type:"field_colour", name:"COLOR", colour:"#ffde59"}], previousStatement:null, nextStatement:null, style:"motion_blocks" },
  { type:"wand_led_set", message0:"–°–≤–µ—Ç–æ–¥–∏–æ–¥ –ø–∞–ª–æ—á–∫–∏ —Ü–≤–µ—Ç %1 —è—Ä–∫–æ—Å—Ç—å %2", args0:[
      { type: "field_colour", name: "COLOR", colour: "#ffde59" },
      { type: "field_number", name: "BRIGHT", value: 100, min:0, max:100 }
  ], previousStatement:null, nextStatement:null, style:"motion_blocks" },
  { type:"wand_led_signal", message0:"–°–∏–≥–Ω–∞–ª LED %1", args0:[
      {type:"field_dropdown", name:"COLOR", options:[["–ö—Ä–∞—Å–Ω—ã–π","red"],["–°–∏–Ω–∏–π","blue"],["–ó–µ–ª–µ–Ω—ã–π","green"],["–°–ª—É—á–∞–π–Ω—ã–π","random"]]}],
      previousStatement:null, nextStatement:null, style:"motion_blocks"
  },
  { type:"wand_up", message0:"–ü–∞–ª–æ—á–∫–∞ –≤–≤–µ—Ä—Ö", output:"Boolean", style:"input_blocks" },
  { type:"wand_down", message0:"–ü–∞–ª–æ—á–∫–∞ –≤–Ω–∏–∑", output:"Boolean", style:"input_blocks" },
  { type:"wand_left", message0:"–ü–∞–ª–æ—á–∫–∞ –≤–ª–µ–≤–æ", output:"Boolean", style:"input_blocks" },
  { type:"wand_right", message0:"–ü–∞–ª–æ—á–∫–∞ –≤–ø—Ä–∞–≤–æ", output:"Boolean", style:"input_blocks" },
  { type:"wand_moved_x", message0:"–ü–∞–ª–æ—á–∫–∞ —Å–¥–≤–∏–Ω—É–ª–∞—Å—å –ø–æ X", output:"Boolean", style:"input_blocks" },
  { type:"wand_moved_y", message0:"–ü–∞–ª–æ—á–∫–∞ —Å–¥–≤–∏–Ω—É–ª–∞—Å—å –ø–æ Y", output:"Boolean", style:"input_blocks" },
  { type:"wait_seconds", message0:"–ü–æ–¥–æ–∂–¥–∞—Ç—å %1 —Å–µ–∫", args0:[{type:"input_value",name:"SECONDS",check:"Number"}], previousStatement:null, nextStatement:null, style:"flow_blocks" },
  { type:"math_number", message0:"%1", args0:[{type:"field_number",name:"NUM",value:0}], output:"Number", style:"input_blocks" },
  { type: "text", message0: "%1", args0: [{ type: "field_input", name: "TEXT", text: "" }], output: "String", style: "input_blocks" },
  
  /* ---------- –ù–û–í–´–ï –ë–õ–û–ö–ò ---------- */
  {
    type: "if_luminus_mag",
    message0: "–ï—Å–ª–∏ %1 —Ç–æ –ú–∞–≥–∏ –õ—é–º–∏–Ω—É—Å %2 —Ñ–æ–Ω %3 —Å–ø—Ä–∞–π—Ç %4",
    args0: [
      {
        type: "field_dropdown",
        name: "CONDITION",
        options: [
          ["–ø–∞–ª–æ—á–∫–∞ –≤–≤–µ—Ä—Ö—É", "WAND_UP"],
          ["–ø–∞–ª–æ—á–∫–∞ –≤–Ω–∏–∑—É", "WAND_DOWN"],
          ["–≤—Å–µ–≥–¥–∞", "ALWAYS"]
        ]
      },
      {
        type: "field_dropdown",
        name: "MAGIC_TYPE",
        options: [
          ["–∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ", "SPELL"],
          ["—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è", "TRANSFORM"],
          ["–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ", "DISAPPEAR"]
        ]
      },
      {
        type: "field_dropdown",
        name: "BACKGROUND",
        options: [
          ["–°–∏–Ω–∏–π", "#1e1f33"],
          ["–§–∏–æ–ª–µ—Ç–æ–≤—ã–π", "#6A0DAD"],
          ["–ó–µ–ª–µ–Ω—ã–π", "#8eff99"],
          ["–û–≥–Ω–µ–Ω–Ω—ã–π", "#ff6b6b"]
        ]
      },
      {
        type: "field_input",
        name: "SPRITE_URL",
        text: "sprite.png"
      }
    ],
    previousStatement: null,
    nextStatement: null,
    colour: 290
  },
  {
    type: "luminus_effect",
    message0: "–≠—Ñ—Ñ–µ–∫—Ç –õ—é–º–∏–Ω—É—Å %1 –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å %2 —Å–µ–∫—É–Ω–¥",
    args0: [
      {
        type: "field_dropdown",
        name: "EFFECT",
        options: [
          ["—Å–≤–µ—á–µ–Ω–∏–µ", "GLOW"],
          ["–ø—É–ª—å—Å–∞—Ü–∏—è", "PULSE"],
          ["–≤—Å–ø—ã—à–∫–∞", "FLASH"]
        ]
      },
      {
        type: "input_value",
        name: "DURATION",
        check: "Number"
      }
    ],
    previousStatement: null,
    nextStatement: null,
    colour: 210
  },
  
  /* ---------- –ù–û–í–Ü –ë–õ–û–ö–ò –î–õ–Ø –°–õ–Ü–î–£ ---------- */
  {
    type: "set_trail_type",
    message0: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–ø —Å–ª–µ–¥–∞: %1",
    args0: [
      {
        type: "field_dropdown",
        name: "TYPE",
        options: [
          ["–æ–≥–æ–Ω—å", "fire"],
          ["–∏—Å–∫—Ä—ã", "sparkles"],
          ["—Ä–∞–¥—É–≥–∞", "rainbow"],
          ["—Å–Ω–µ–≥", "snow"],
          ["–º–∞–≥–∏—è", "magic"],
          ["–≤—ã–∫–ª—é—á–∏—Ç—å", "none"]
        ]
      }
    ],
    previousStatement: null,
    nextStatement: null,
    colour: 230,
    tooltip: "–ò–∑–º–µ–Ω—è–µ—Ç —Ç–∏–ø —Å–ª–µ–¥–∞ –∑–∞ –∫—É—Ä—Å–æ—Ä–æ–º"
  },
  {
    type: "set_trail_color",
    message0: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–≤–µ—Ç —Å–ª–µ–¥–∞: %1",
    args0: [
      {
        type: "field_colour",
        name: "COLOR",
        colour: "#ff9900"
      }
    ],
    previousStatement: null,
    nextStatement: null,
    colour: 230,
    tooltip: "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ü–≤–µ—Ç —Å–ª–µ–¥–∞"
  },
  {
    type: "set_trail_size",
    message0: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Å–ª–µ–¥–∞: %1",
    args0: [
      {
        type: "input_value",
        name: "SIZE",
        check: "Number"
      }
    ],
    previousStatement: null,
    nextStatement: null,
    colour: 230,
    tooltip: "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —á–∞—Å—Ç–∏—Ü —Å–ª–µ–¥–∞"
  },
  {
    type: "clear_trail",
    message0: "–û—á–∏—Å—Ç–∏—Ç—å —Å–ª–µ–¥",
    previousStatement: null,
    nextStatement: null,
    colour: 230,
    tooltip: "–û—á–∏—â–∞–µ—Ç –≤–µ—Å—å —Å–ª–µ–¥"
  },
  {
    type: "wand_get_x",
    message0: "–ü–æ–∑–∏—Ü–∏—è –ø–∞–ª–æ—á–∫–∏ X",
    output: "Number",
    style: "input_blocks",
    tooltip: "–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É X –ø–∞–ª–æ—á–∫–∏"
  },
  {
    type: "wand_get_y",
    message0: "–ü–æ–∑–∏—Ü–∏—è –ø–∞–ª–æ—á–∫–∏ Y",
    output: "Number",
    style: "input_blocks",
    tooltip: "–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É Y –ø–∞–ª–æ—á–∫–∏"
  },
  {
    type: "use_wand_position",
    message0: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–∞–ª–æ—á–∫–∏",
    previousStatement: null,
    nextStatement: null,
    style: "motion_blocks",
    tooltip: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–∞–ª–æ—á–∫–∏ –¥–ª—è —Å–ª–µ–¥–∞"
  }
]);

/* ---------- JS Code Generator ---------- */
Blockly.JavaScript['start_program'] = ()=> '';
Blockly.JavaScript['wand_forever'] = block => {
  const branch = Blockly.JavaScript.statementToCode(block,'DO');
  return `async function loop(){while(isRunning){${branch}await new Promise(r=>setTimeout(r,10));}}loop();`;
};
Blockly.JavaScript['wand_move_to_xy'] = block => {
  const x = Blockly.JavaScript.valueToCode(block,'X',Blockly.JavaScript.ORDER_NONE)||0;
  const y = Blockly.JavaScript.valueToCode(block,'Y',Blockly.JavaScript.ORDER_NONE)||0;
  return `cursorX=${x}; cursorY=${y};`;
};
Blockly.JavaScript['wand_draw_circle'] = block => {
  const r = Blockly.JavaScript.valueToCode(block,'RADIUS',Blockly.JavaScript.ORDER_NONE)||10;
  const color = block.getFieldValue('COLOR');
  return `history.push({type:'circle',x:cursorX+canvas.width/2,y:cursorY+canvas.height/2,r:${r},c:'${color}'});`;
};
Blockly.JavaScript['wand_cast_color'] = block => {
  const color = block.getFieldValue('COLOR');
  return `let c='${color}'; if(c==='random'){c='#'+Math.floor(Math.random()*16777215).toString(16);} history.push({type:'circle',x:cursorX+canvas.width/2,y:cursorY+canvas.height/2,r:20,c:c});`;
};
Blockly.JavaScript['remove_fire'] = () => {
  return `history = history.filter(item => item.type !== 'circle');\n`;
};
Blockly.JavaScript['create_object'] = block => {
  const url = Blockly.JavaScript.valueToCode(block, 'SPRITE_URL', Blockly.JavaScript.ORDER_NONE) || '""';
  const x = Blockly.JavaScript.valueToCode(block, 'X', Blockly.JavaScript.ORDER_NONE) || 0;
  const y = Blockly.JavaScript.valueToCode(block, 'Y', Blockly.JavaScript.ORDER_NONE) || 0;
  return `
    (function() {
        const img = new Image();
        img.src = ${url};
        img.onload = function() {
            history.push({type:'sprite', img: img, x:(${x})+canvas.width/2, y:(${y})+canvas.height/2, w: 50, h: 50});
        };
    })();
  `;
};
Blockly.JavaScript['set_price'] = block => {
  const variable = Blockly.JavaScript.nameDB_.getName(block.getFieldValue('VAR'), Blockly.VARIABLE_CATEGORY_NAME);
  const value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ASSIGNMENT) || '0';
  return `${variable} = ${value};\n`;
};
Blockly.JavaScript['wand_led_color'] = b=>`sendLedColor('${b.getFieldValue('COLOR')}');`;
Blockly.JavaScript['wand_led_set'] = b=>`sendLedColor('${b.getFieldValue('COLOR')}', ${b.getFieldValue('BRIGHT')});`;
Blockly.JavaScript['wand_led_signal'] = b=>{
  const color = b.getFieldValue('COLOR');
  return `sendLedSignal('${color}');`;
};
Blockly.JavaScript['wand_up'] = ()=>[`wandState.tiltY>20`,Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['wand_down'] = ()=>[`wandState.tiltY<-20`,Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['wand_left'] = ()=>[`wandState.tiltX<-20`,Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['wand_right'] = ()=>[`wandState.tiltX>20`,Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['wand_moved_x'] = ()=>[`Math.abs(wandState.tiltX)>5`,Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['wand_moved_y'] = ()=>[`Math.abs(wandState.tiltY)>5`,Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['wait_seconds'] = block => {
  const sec = Blockly.JavaScript.valueToCode(block,'SECONDS',Blockly.JavaScript.ORDER_NONE)||1;
  return `await new Promise(r=>setTimeout(r,${sec}*1000));`;
};
Blockly.JavaScript['math_number'] = block => [Number(block.getFieldValue('NUM')),Blockly.JavaScript.ORDER_ATOMIC];
Blockly.JavaScript['text'] = block => {
  const text = block.getFieldValue('TEXT');
  return [`'${text}'`, Blockly.JavaScript.ORDER_ATOMIC];
};

/* ---------- –ù–û–í–´–ï –ì–ï–ù–ï–†–ê–¢–û–†–´ –ö–û–î–ê ---------- */
Blockly.JavaScript['if_luminus_mag'] = function(block) {
  const condition = block.getFieldValue('CONDITION');
  const magicType = block.getFieldValue('MAGIC_TYPE');
  const bg = block.getFieldValue('BACKGROUND');
  const sprite = block.getFieldValue('SPRITE_URL');
  
  let conditionCode = '';
  switch(condition) {
    case 'WAND_UP':
      conditionCode = 'wandState.tiltY > 20';
      break;
    case 'WAND_DOWN':
      conditionCode = 'wandState.tiltY < -20';
      break;
    case 'ALWAYS':
      conditionCode = 'true';
      break;
  }
  
  return `
    if (${conditionCode}) {
      // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞
      document.getElementById('canvasBox').style.backgroundColor = '${bg}';
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–π—Ç–∞
      (function(){
        const img = new Image();
        img.src = '${sprite}';
        img.onload = function() {
          history.push({
            type: 'sprite',
            img: img,
            x: canvas.width/2,
            y: canvas.height/2,
            w: 60,
            h: 60,
            magicType: '${magicType}'
          });
        };
        img.onerror = function() {
          console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–π—Ç');
        };
      })();
    }
  `;
};

Blockly.JavaScript['luminus_effect'] = function(block) {
  const effect = block.getFieldValue('EFFECT');
  const duration = Blockly.JavaScript.valueToCode(block, 'DURATION', Blockly.JavaScript.ORDER_ATOMIC) || '1';
  
  return `
    if ('${effect}' === 'FLASH') {
      const original = document.getElementById('canvasBox').style.backgroundColor;
      document.getElementById('canvasBox').style.backgroundColor = '#ffffff';
      setTimeout(() => {
        document.getElementById('canvasBox').style.backgroundColor = original;
      }, 300);
    }
  `;
};

/* ---------- –ì–ï–ù–ï–†–ê–¢–û–†–ò –î–õ–Ø –ù–û–í–ò–• –ë–õ–û–ö–Ü–í ---------- */
Blockly.JavaScript['set_trail_type'] = function(block) {
  const type = block.getFieldValue('TYPE');
  if (type === 'none') {
    return `trailSettings.enabled = false;\n`;
  }
  return `trailSettings.type = '${type}';\ntrailSettings.enabled = true;\n`;
};

Blockly.JavaScript['set_trail_color'] = function(block) {
  const color = block.getFieldValue('COLOR');
  return `trailSettings.color = '${color}';\n`;
};

Blockly.JavaScript['set_trail_size'] = function(block) {
  const size = Blockly.JavaScript.valueToCode(block, 'SIZE', Blockly.JavaScript.ORDER_ATOMIC) || '1';
  return `trailSettings.size = ${size};\n`;
};

Blockly.JavaScript['clear_trail'] = function() {
  return `clearAllTrails();\n`;
};

Blockly.JavaScript['wand_get_x'] = function() {
  return [`wandState.tiltX`, Blockly.JavaScript.ORDER_ATOMIC];
};

Blockly.JavaScript['wand_get_y'] = function() {
  return [`wandState.tiltY`, Blockly.JavaScript.ORDER_ATOMIC];
};

Blockly.JavaScript['use_wand_position'] = function() {
  return `useWandPosition = true;\n`;
};

/* ---------- Workspace ---------- */
let workspace = Blockly.inject('blocklyDiv',{
  toolbox: document.getElementById('toolbox'),
  theme:DARK_THEME,
  grid:{spacing:20,length:3,colour:'#3a3c41',snap:true},
  trashcan:true
});

/* ---------- Canvas ---------- */
let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');

/* ---------- –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–ù–û–ö –î–õ–Ø –°–õ–Ü–î–£ ---------- */
class TrailParticle {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.size = Math.random() * 8 + 4;
    this.life = 1;
    this.fadeSpeed = 0.01 + Math.random() * 0.02;
    this.angle = Math.random() * Math.PI * 2;
    this.speed = Math.random() * 0.5 + 0.2;
    this.color = this.getColorForType();
    this.createdAt = Date.now();
  }

  getColorForType() {
    const type = trailSettings.type;
    const customColor = trailSettings.color;
    
    if (customColor) {
      return this.hexToRgb(customColor);
    }
    
    switch(type) {
      case 'fire':
        const fireColors = [
          [255, 100, 0],   // –æ—Ä–∞–Ω–∂–µ–≤—ã–π
          [255, 50, 0],    // –∫—Ä–∞—Å–Ω—ã–π
          [255, 150, 0],   // –∂–µ–ª—Ç—ã–π
          [255, 200, 100]  // —Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π
        ];
        return fireColors[Math.floor(Math.random() * fireColors.length)];
        
      case 'sparkles':
        const sparkleColors = [
          [255, 255, 200], // –±–µ–ª–æ-–∂–µ–ª—Ç—ã–π
          [200, 255, 255], // –≥–æ–ª—É–±–æ–π
          [255, 200, 255], // —Ä–æ–∑–æ–≤—ã–π
          [200, 255, 200]  // —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
        ];
        return sparkleColors[Math.floor(Math.random() * sparkleColors.length)];
        
      case 'rainbow':
        const hue = Date.now() * 0.001 + Math.random() * Math.PI * 2;
        return this.hslToRgb(hue % (Math.PI * 2), 1, 0.5);
        
      case 'snow':
        return [255, 255, 255]; // –±–µ–ª—ã–π
        
      case 'magic':
        const magicColors = [
          [138, 197, 255], // —Å–∏–Ω–∏–π
          [142, 255, 153], // –∑–µ–ª–µ–Ω—ã–π
          [255, 142, 142], // –∫—Ä–∞—Å–Ω—ã–π
          [255, 222, 89]   // –∂–µ–ª—Ç—ã–π
        ];
        return magicColors[Math.floor(Math.random() * magicColors.length)];
        
      default:
        return [255, 100, 0];
    }
  }

  hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? [
      parseInt(result[1], 16),
      parseInt(result[2], 16),
      parseInt(result[3], 16)
    ] : [255, 100, 0];
  }

  hslToRgb(h, s, l) {
    let r, g, b;
    
    if (s === 0) {
      r = g = b = l;
    } else {
      const hue2rgb = (p, q, t) => {
        if (t < 0) t += 1;
        if (t > 1) t -= 1;
        if (t < 1/6) return p + (q - p) * 6 * t;
        if (t < 1/2) return q;
        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
        return p;
      };
      
      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
      const p = 2 * l - q;
      
      r = hue2rgb(p, q, h + 1/3);
      g = hue2rgb(p, q, h);
      b = hue2rgb(p, q, h - 1/3);
    }
    
    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
  }

  update(targetX, targetY) {
    // –î–≤–∏–∂–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
    switch(trailSettings.type) {
      case 'fire':
        this.x += Math.sin(this.angle) * this.speed;
        this.y -= this.speed * 2; // –û–≥–æ–Ω—å –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö
        this.angle += (Math.random() - 0.5) * 0.2;
        break;
        
      case 'sparkles':
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;
        this.angle += 0.05;
        break;
        
      case 'rainbow':
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;
        this.angle += 0.03;
        this.color = this.hslToRgb((Date.now() * 0.001 + this.angle) % (Math.PI * 2), 1, 0.5);
        break;
        
      case 'snow':
        this.x += (Math.random() - 0.5) * 0.5;
        this.y += this.speed;
        break;
        
      case 'magic':
        const dx = targetX - this.x;
        const dy = targetY - this.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist > 5) {
          this.x += dx * 0.02;
          this.y += dy * 0.02;
        }
        this.size = Math.sin(Date.now() * 0.001 + this.angle) * 3 + 5;
        break;
    }
    
    this.life -= this.fadeSpeed;
    this.size *= 0.99;
  }

  draw() {
    if (this.life <= 0) return;
    
    const [r, g, b] = this.color;
    const alpha = this.life;
    const size = this.size * trailSettings.size;
    
    ctx.save();
    
    // –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
    switch(trailSettings.type) {
      case 'sparkles':
        // –ë–ª–µ—Å—Ç—è—â–∏–µ –∑–≤–µ–∑–¥–æ—á–∫–∏
        ctx.shadowColor = `rgba(${r}, ${g}, ${b}, ${alpha})`;
        ctx.shadowBlur = 10;
        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
        ctx.beginPath();
        for (let i = 0; i < 5; i++) {
          const angle = (Math.PI * 2 / 5) * i;
          const spike = size * 1.5;
          const x2 = this.x + Math.cos(angle) * spike;
          const y2 = this.y + Math.sin(angle) * spike;
          if (i === 0) ctx.moveTo(x2, y2);
          else ctx.lineTo(x2, y2);
        }
        ctx.closePath();
        ctx.fill();
        break;
        
      case 'snow':
        // –°–Ω–µ–∂–∏–Ω–∫–∏
        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
        ctx.fill();
        
        // –ö—Ä–µ—Å—Ç–∏–∫ –¥–ª—è —Å–Ω–µ–∂–∏–Ω–∫–∏
        ctx.strokeStyle = `rgba(200, 230, 255, ${alpha * 0.7})`;
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(this.x - size, this.y);
        ctx.lineTo(this.x + size, this.y);
        ctx.moveTo(this.x, this.y - size);
        ctx.lineTo(this.x, this.y + size);
        ctx.stroke();
        break;
        
      default:
        // –û–±—ã—á–Ω—ã–µ –∫—Ä—É–≥–ª—ã–µ —á–∞—Å—Ç–∏—Ü—ã
        const gradient = ctx.createRadialGradient(
          this.x, this.y, 0,
          this.x, this.y, size
        );
        
        if (trailSettings.type === 'fire') {
          gradient.addColorStop(0, `rgba(255, 255, 200, ${alpha})`);
          gradient.addColorStop(0.5, `rgba(${r}, ${g}, ${b}, ${alpha * 0.7})`);
          gradient.addColorStop(1, `rgba(${r}, ${g}, ${b}, 0)`);
        } else {
          gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, ${alpha})`);
          gradient.addColorStop(0.7, `rgba(${r}, ${g}, ${b}, ${alpha * 0.5})`);
          gradient.addColorStop(1, `rgba(${r}, ${g}, ${b}, 0)`);
        }
        
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
        ctx.fill();
    }
    
    ctx.restore();
  }
}

// –ú–∞—Å—Å–∏–≤ —á–∞—Å—Ç–∏—Ü —Å–ª–µ–¥–∞
let trailParticles = [];
let lastTrailTime = 0;
const trailInterval = 50; // –º—Å –º–µ–∂–¥—É —Å–æ–∑–¥–∞–Ω–∏–µ–º —á–∞—Å—Ç–∏—Ü
let useWandPosition = false; // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ –ø–æ–∑–∏—Ü–∏—é –ø–∞–ª–æ—á–∫–∏

/* ---------- –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–û–ë–û–¢–ò –ó–Ü –°–õ–Ü–î–û–ú ---------- */
function clearAllTrails() {
  trailParticles = [];
}

function updateTrail(targetX, targetY) {
  if (!trailSettings.enabled) return;
  
  const now = Date.now();
  
  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã
  if (now - lastTrailTime > trailInterval) {
    for (let i = 0; i < 3; i++) {
      const offsetX = (Math.random() - 0.5) * 20;
      const offsetY = (Math.random() - 0.5) * 20;
      trailParticles.push(new TrailParticle(targetX + offsetX, targetY + offsetY));
    }
    lastTrailTime = now;
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã
  trailParticles = trailParticles.filter(particle => {
    particle.update(targetX, targetY);
    return particle.life > 0 && particle.size > 0.5;
  });
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü
  if (trailParticles.length > 500) {
    trailParticles = trailParticles.slice(-500);
  }
}

function drawTrail() {
  trailParticles.forEach(particle => {
    particle.draw();
  });
}

// –ü–æ–∑–∏—Ü–∏—è –¥–ª—è —Å–ª–µ–¥–∞ (–º—ã—à—å –∏–ª–∏ –ø–∞–ª–æ—á–∫–∞)
let trailTargetX = canvas.width / 2;
let trailTargetY = canvas.height / 2;

// –°–ª–µ–¥–∏–º –∑–∞ –º—ã—à–∫–æ–π
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  trailTargetX = e.clientX - rect.left;
  trailTargetY = e.clientY - rect.top;
  
  // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–ª–æ—á–∫–∏
  wandState.tiltX = Math.round((trailTargetX / canvas.width) * 200 - 100);
  wandState.tiltY = Math.round((trailTargetY / canvas.height) * 200 - 100);
});

// –ö–æ–≥–¥–∞ –º—ã—à—å –ø–æ–∫–∏–¥–∞–µ—Ç canvas
canvas.addEventListener('mouseleave', () => {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ü–µ–Ω—Ç—Ä
  trailTargetX = canvas.width / 2;
  trailTargetY = canvas.height / 2;
  wandState.tiltX = 0;
  wandState.tiltY = 0;
});

function draw() {
  // –û—á–∏—â–∞–µ–º canvas
  ctx.fillStyle = '#0d0d0f';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–∞–ª–æ—á–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–ª—å
  if (useWandPosition && wandConnected) {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º tiltX/tiltY –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã canvas
    trailTargetX = canvas.width / 2 + wandState.tiltX * (canvas.width / 200);
    trailTargetY = canvas.height / 2 + wandState.tiltY * (canvas.height / 200);
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–µ–¥
  updateTrail(trailTargetX, trailTargetY);
  
  // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—Ä–∏—é (–∫—Ä—É–≥–∏ –∏ —Å–ø—Ä–∞–π—Ç—ã)
  history.forEach(item => {
    if (item.type === 'circle') {
      ctx.beginPath();
      ctx.arc(item.x, item.y, item.r, 0, Math.PI * 2);
      ctx.fillStyle = item.c;
      ctx.fill();
    } else if (item.type === 'sprite' && item.img && item.img.complete) {
      const drawX = item.x - item.w / 2;
      const drawY = item.y - item.h / 2;
      ctx.drawImage(item.img, drawX, drawY, item.w, item.h);
    }
  });
  
  // –†–∏—Å—É–µ–º —Å–ª–µ–¥
  drawTrail();
}

function resizeCanvas() {
  const box = document.getElementById('canvasBox');
  canvas.width = box.clientWidth - 8;
  canvas.height = box.clientHeight - 8;
  
  // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏
  trailTargetX = canvas.width / 2;
  trailTargetY = canvas.height / 2;
  
  // –û—á–∏—â–∞–µ–º —Å–ª–µ–¥ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
  clearAllTrails();
  
  draw();
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function updateCursor() {
  if (isRunning) {
    cursorX = wandState.tiltX;
    cursorY = wandState.tiltY;
  }
  requestAnimationFrame(updateCursor);
}
updateCursor();

async function runCode() {
  if (isRunning) return;
  isRunning = true;
  history = [];
  cursorX = wandState.tiltX;
  cursorY = wandState.tiltY;
  clearInterval(drawInterval);
  drawInterval = setInterval(draw, 33);
  
  const code = Blockly.JavaScript.workspaceToCode(workspace);
  try {
    await (async () => {
      if (typeof —Ü–µ–Ω–∞ === 'undefined') {
        let —Ü–µ–Ω–∞ = 0;
      }
      // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –±–ª–æ–∫–æ–≤
      window.trailSettings = trailSettings;
      window.clearAllTrails = clearAllTrails;
      window.wandState = wandState;
      window.useWandPosition = useWandPosition;
      
      await eval(code);
    })();
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞:', e);
  }
}

function stopCode() {
  isRunning = false;
  clearInterval(drawInterval);
}

/* ---------- Settings Functions ---------- */
const settingsBtn = document.getElementById('settingsBtn');
const settingsModal = document.getElementById('settingsModal');
settingsBtn.addEventListener('click', () => settingsModal.style.display = 'block');
function closeSettings() {
  settingsModal.style.display = 'none';
}

async function connectBluetooth() {
  try {
    if (!navigator.bluetooth) {
      throw new Error('Bluetooth –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
    }
    
    bluetoothDevice = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true,
      optionalServices: ['battery_service', 'generic_access']
    });
    
    bluetoothServer = await bluetoothDevice.gatt.connect();
    console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫', bluetoothDevice.name);
    wandConnected = true;
    useWandPosition = true; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–∞–ª–æ—á–∫–∏ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
    alert('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ: ' + bluetoothDevice.name);
    
  } catch (e) {
    console.error(e);
    alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + e.message);
  }
}

function emulateConnection() {
  wandConnected = true;
  useWandPosition = true;
  alert('–≠–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—ã—à—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–ª–æ—á–∫–æ–π.');
}

function changeLanguage() {
  alert('–°–º–µ–Ω–∞ —è–∑—ã–∫–∞ (—Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
}

function sendLedColor(color, brightness = 100) {
  console.log(`LED: —Ü–≤–µ—Ç ${color}, —è—Ä–∫–æ—Å—Ç—å ${brightness}%`);
  if (!ledCharacteristic) return;
}

function sendLedSignal(color) {
  let c = color;
  if (c === 'random') {
    c = '#' + Math.floor(Math.random() * 16777215).toString(16);
  }
  console.log('–°–∏–≥–Ω–∞–ª LED:', c);
  sendLedColor(c);
}

/* ---------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---------- */
window.addEventListener('load', () => {
  console.log('Kano Wand Coding Kit –∑–∞–≥—Ä—É–∂–µ–Ω!');
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
  drawInterval = setInterval(draw, 33);
});
</script src="kano-wand.js"></script>

</body>
</html>

   

